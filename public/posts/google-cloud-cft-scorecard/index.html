<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  
  <title>Google Cloud CFT Scorecard | Jorgeliauw.nl</title>
  <meta name="viewport" content="width=device-width,minimum-scale=1">
  <meta name="description"
    content="Scan your Cloud with Cloud Foundation Toolkit (CFT)">
  <meta name="generator" content="Hugo 0.121.2">
  
  
  
  
  <meta name="robots" content="noindex, nofollow">
  

  
<link rel="stylesheet" href="/ananke/css/main.min.css" >



  

  
  

  

  

  <meta property="og:title" content="Google Cloud CFT Scorecard" />
<meta property="og:description" content="Scan your Cloud with Cloud Foundation Toolkit (CFT)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jorgeliauw.nl/posts/google-cloud-cft-scorecard/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-10T12:00:00+01:00" />
<meta property="article:modified_time" content="2023-03-10T12:00:00+01:00" />

<meta itemprop="name" content="Google Cloud CFT Scorecard">
<meta itemprop="description" content="Scan your Cloud with Cloud Foundation Toolkit (CFT)"><meta itemprop="datePublished" content="2023-03-10T12:00:00+01:00" />
<meta itemprop="dateModified" content="2023-03-10T12:00:00+01:00" />
<meta itemprop="wordCount" content="546">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Google Cloud CFT Scorecard"/>
<meta name="twitter:description" content="Scan your Cloud with Cloud Foundation Toolkit (CFT)"/>

  
</head>

<body class="ma0 avenir bg-near-white">

  
   
  

  
  
  <header class="cover bg-top" style="background-image: url('https://jorgeliauw.nl/images/GoogleCloudNext-Jorge-Presenting-Security-2022.webp');">
    <div class="bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Jorgeliauw.nl
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/about/" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/contact/" title="Contact page">
              Contact
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/posts/" title="Posts page">
              Posts
            </a>
          </li>
          
        </ul>
      
      
<div class="ananke-socials">
  
    <a href="https://www.linkedin.com/in/jorgeliauw/" target="_blank" class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>
    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Google Cloud CFT Scorecard</h1>
          
            <h2 class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">
              Scan your Cloud with Cloud Foundation Toolkit (CFT)
            </h2>
          
        
      </div>
    </div>
  </header>



  <main class="pb7" role="main">
    
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
      
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://jorgeliauw.nl/posts/google-cloud-cft-scorecard/&amp;title=Google%20Cloud%20CFT%20Scorecard" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn">
        
        <span class="icon"> <svg style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span>
        
      </a>
    
  </div>


      <h1 class="f1 athelas mt3 mb1">Google Cloud CFT Scorecard</h1>
      
      <p class="tracked">
          By <strong>
          
              Jorge Liauw
          
          </strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2023-03-10T12:00:00+01:00">10 March 2023</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links #000000 pr4-l w-two-thirds-l"><p>Check your current Google Cloud setup against Google Cloud Foundation Toolkit (CFT),
with the CFT Scorecard.</p>
<p>We will export data, IAM, Org Policy and Access Policy data from Cloud Asset Inventory (CAI).</p>
<p>The CAI exports can be done on a organization, folder or project level.</p>
<h1 id="could-also-use---project---folder-or---organization">could also use &ndash;project &ndash;folder or &ndash;organization</h1>
<p>The CFT Scorecard is integrated into the CFT CLI and provides an easy integration with Forseti Config Validator. It can be used to print a scorecard of your GCP environment, for resources and IAM policies in Cloud Asset Inventory (CAI) exports. The policies tested are based on constraints and constraint templates from the Config Validator policy library.</p>
<p>You&rsquo;ll need to use CAI to generate the resource and IAM policy information for the project.</p>
<p><a href="https://github.com/GoogleCloudPlatform/cloud-foundation-toolkit/blob/master/cli/docs/scorecard.md">https://github.com/GoogleCloudPlatform/cloud-foundation-toolkit/blob/master/cli/docs/scorecard.md</a></p>
<p>What?
Why?
How?</p>
<figure><img src="/images/Jorge-Liauw-Certified-Google%20Cloud%20Certified-Professional%20Cloud%20Security%20Engineer-30122022.png"/>
</figure>

<p><a href="https://github.com/GoogleCloudPlatform/cloud-foundation-toolkit/blob/master/cli/docs/scorecard.md">https://github.com/GoogleCloudPlatform/cloud-foundation-toolkit/blob/master/cli/docs/scorecard.md</a></p>
<p><a href="https://cloud.google.com/asset-inventory/docs/access-control#required_permissions">https://cloud.google.com/asset-inventory/docs/access-control#required_permissions</a></p>
<p>Scorecard has two dependencies:
Cloud Asset Inventory (CAI)
Policy Library</p>
<pre tabindex="0"><code>export GOOGLE_PROJECT=$DEVSHELL_PROJECT_ID
export CAI_BUCKET_NAME=CAI-$GOOGLE_PROJECT
</code></pre><h1 id="for-downloading-cai-data-from-gcs">For downloading CAI data from GCS</h1>
<pre tabindex="0"><code>gcloud config set core/project $GOOGLE_PROJECT   
</code></pre><h1 id="for-exporting-cai-data-to-gcs">For exporting CAI data to GCS</h1>
<pre tabindex="0"><code>gcloud services enable cloudasset.googleapis.com
</code></pre><p>#Create Service Account</p>
<pre tabindex="0"><code>gcloud beta services identity create --service=cloudasset.googleapis.com --project=$GOOGLE_PROJECT
</code></pre><p>#Grant Storage admin role to the Cloud Asset Service account</p>
<pre tabindex="0"><code>gcloud projects add-iam-policy-binding ${GOOGLE_PROJECT}  \
   --member=serviceAccount:service-$(gcloud projects list --filter=&#34;$GOOGLE_PROJECT&#34; --format=&#34;value(PROJECT_NUMBER)&#34;)@gcp-sa-cloudasset.iam.gserviceaccount.com \
   --role=roles/storage.admin
</code></pre><h1 id="create-google-cloud-storage-buckets">Create Google Cloud Storage Buckets</h1>
<pre tabindex="0"><code>gsutil mb gs://$CAI_BUCKET_NAME
gsutil mb gs://$PUBLIC_BUCKET_NAME
</code></pre><h1 id="export-resource-data">Export resource data</h1>
<pre tabindex="0"><code>gcloud asset export --output-path=gs://$CAI_BUCKET_NAME/resource_inventory.json \
    --content-type=resource \
    --project=$GOOGLE_PROJECT 
</code></pre><h1 id="check-export-status">Check export status</h1>
<pre tabindex="0"><code>gcloud asset operations describe projects/819251468686/operations/ExportAssets/RESOURCE/fb84873413de923aa1818964564fec8d
</code></pre><h1 id="export-cai-data">Export CAI data</h1>
<h1 id="export-resource-data-1">Export resource data</h1>
<pre tabindex="0"><code>gcloud asset export \
    --output-path=gs://$CAI_BUCKET_NAME/resource_inventory.json \
    --content-type=resource \
    --project=$GOOGLE_PROJECT
</code></pre><h1 id="export-iam-data">Export IAM data</h1>
<pre tabindex="0"><code>gcloud asset export \
    --output-path=gs://$CAI_BUCKET_NAME/iam_inventory.json \
    --content-type=iam-policy \
    --project=$GOOGLE_PROJECT
</code></pre><h1 id="export-org-policy-data">Export org policy data</h1>
<pre tabindex="0"><code>gcloud asset export \
    --output-path=gs://$CAI_BUCKET_NAME/org_policy_inventory.json \
    --content-type=org-policy \
    --project=$GOOGLE_PROJECT
</code></pre><h1 id="export-access-policy-data">Export access policy data</h1>
<pre tabindex="0"><code>gcloud asset export \
    --output-path=gs://$CAI_BUCKET_NAME/access_policy_inventory.json \
    --content-type=access-policy \
    --project=$GOOGLE_PROJECT
</code></pre><h1 id="os-x">OS X</h1>
<pre tabindex="0"><code>curl -o cft https://storage.googleapis.com/cft-cli/latest/cft-darwin-amd64
</code></pre><h1 id="linux">Linux</h1>
<pre tabindex="0"><code>curl -o cft https://storage.googleapis.com/cft-cli/latest/cft-linux-amd64
</code></pre><h1 id="make-cft-executable">Make cft executable</h1>
<pre tabindex="0"><code>chmod +x cft
</code></pre><pre tabindex="0"><code>git clone https://github.com/forseti-security/policy-library.git

cp policy-library/samples/storage_denylist_public.yaml policy-library/policies/constraints/
</code></pre><p>#Run CFT scorecard application</p>
<pre tabindex="0"><code>./cft scorecard --policy-path=./policy-library/ \
    --bucket=$CAI_BUCKET_NAME
</code></pre><p>===</p>
<p>Clone the Policy Library:</p>
<p>git clone <a href="https://github.com/forseti-security/policy-library.git">https://github.com/forseti-security/policy-library.git</a>
Copied!
You realize Policy Library enforces policies that are located in the policy-library/policies/constraints folder, in which case you can copy a sample policy from the samples directory into the constraints directory.</p>
<p>cp policy-library/samples/storage_denylist_public.yaml policy-library/policies/constraints/</p>
<p>===</p>
<p>Add more constraints to CFT scorecard
Add the following constraint to ensure you are entirely aware who has the IAM roles/owner role aside from your allowlisted user:</p>
<pre tabindex="0"><code># Add a new policy to blacklist the IAM Owner Role
cat &gt; policy-library/policies/constraints/iam_allowlist_owner.yaml &lt;&lt; EOF
apiVersion: constraints.gatekeeper.sh/v1alpha1
kind: GCPIAMAllowedBindingsConstraintV3
metadata:
  name: allowlist_owner
  annotations:
    description: List any users granted Owner
spec:
  severity: high
  match:
    target: [&#34;organizations/**&#34;]
    exclude: []
  parameters:
    mode: allowlist
    assetType: cloudresourcemanager.googleapis.com/Project
    role: roles/owner
    members:
    - &#34;serviceAccount:admiral@qwiklabs-services-prod.iam.gserviceaccount.com&#34;
EOF
</code></pre><p>Rerun CFT scorecard:</p>
<p>./cft scorecard &ndash;policy-path=policy-library/ &ndash;bucket=$CAI_BUCKET_NAME</p>
<p>Ok, it all looks clean, but let&rsquo;s look at roles/editor, too.</p>
<p>Set two extra variables to help with the new constraint creation:</p>
<pre tabindex="0"><code>export USER_ACCOUNT=&#34;$(gcloud config get-value core/account)&#34;
export PROJECT_NUMBER=$(gcloud projects describe $GOOGLE_PROJECT --format=&#34;get(projectNumber)&#34;)
</code></pre><p>Create the following constraint that will allowlist all the valid accounts:</p>
<pre tabindex="0"><code># Add a new policy to allowlist the IAM Editor Role
cat &gt; policy-library/policies/constraints/iam_identify_outside_editors.yaml &lt;&lt; EOF
apiVersion: constraints.gatekeeper.sh/v1alpha1
kind: GCPIAMAllowedBindingsConstraintV3
metadata:
  name: identify_outside_editors
  annotations:
    description: list any users outside the organization granted Editor
spec:
  severity: high
  match:
    target: [&#34;organizations/**&#34;]
    exclude: []
  parameters:
    mode: allowlist
    assetType: cloudresourcemanager.googleapis.com/Project
    role: roles/editor
    members:
    - &#34;user:$USER_ACCOUNT&#34;
    - &#34;serviceAccount:**$PROJECT_NUMBER**gserviceaccount.com&#34;
    - &#34;serviceAccount:$GOOGLE_PROJECT**gserviceaccount.com&#34;
EOF
</code></pre><p>Rerun CFT scorecard:</p>
<p>./cft scorecard &ndash;policy-path=policy-library/ &ndash;bucket=$CAI_BUCKET_NAME</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

  </main>
  <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://jorgeliauw.nl" >
    &copy;  Jorgeliauw.nl 2024 
  </a>
    <div>
<div class="ananke-socials">
  
    <a href="https://www.linkedin.com/in/jorgeliauw/" target="_blank" class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div></div>
  </div>
</footer>

</body>

</html>